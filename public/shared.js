"use strict";function remove(e,n){e.splice(e.indexOf(n),1)}function find(e,n){for(var t=0;t<e.length;t++)if(e[t].id===n)return e[t]}function findIndex(e,n){for(var t=0;t<e.length;t++)if(e[t].id===n)return t}function applyStyleOn(e,n){for(var t in n)e.style[t]=n[t]}function applyAttributesOn(e,n){for(var t in n)e.setAttribute(t,n[t])}function createUIElement(e,n,t){var i=document.createElement(e);n=n||{},t=t||{},applyAttributesOn(i,n);for(var a in t)i.addEventListener(a,t[a]);return i}function Game(e,n){this.isServer=!!n,this.room=e,this.id=this.room.id,this.dungeons=[],this.dungeonsUI=[]}Game.prototype={removeDungeon:function(e){var n=find(this.dungeons,e);if(n)var t=this.dungeons.indexOf(n);t>=0&&this.dungeons.splice(t,1)},addDungeon:function(e){find(this.dungeons,e.id)?console.warn(e.id+"already exist in thsi game"):this.dungeons.push(e)},updateGame:function(e){this.updateDungeons(e.dungeons)},updateDungeons:function(e){function n(){var a=e[i],o=a?findIndex(t.dungeons,a.id):void 0,d=o>=0?t.dungeons[o]:void 0;if(d&&a&&d.id===a.id)d.area=a.area,d.life=a.life,d.money=a.money,d.player=a.player;else if(!d&&a)t.dungeons.push(a),t.isServer||t.addDungeonUI(a);else if(t.dungeons[i]&&!a&&!find(e,t.dungeons[i].id)){var s=t.dungeons.splice(i,1)[0];t.dungeonsUI.splice(i,1),t.isServer||t.deleteDungeonUI(s.id)}--i<0||n()}var t=this,i=Math.max(Math.max(t.dungeons.length-1,e.length-1),0);n(),t.isServer||t.updateUI()},deleteDungeonUI:function(e){var n=document.getElementById(e);document.getElementsByTagName("main")[0].removeChild(n)},addDungeonUI:function(e){var n={id:e.id,area:[]},t=createUIElement("div",{class:"area-container",id:e.id}),i=createUIElement("h1",{class:"dungeon-name"}),a=createUIElement("div",{class:"area"}),o=createUIElement("div",{class:"life-container"}),d=createUIElement("div",{class:"life-bar"}),s=createUIElement("p",{class:"life-count"}),r=createUIElement("p",{class:"money-count"});e.area.forEach(function(e){var t=[];e.forEach(function(e){var n=createUIElement("div",{class:e});a.appendChild(n),t.push(n)}),n.area.push(t)}),o.appendChild(d),o.appendChild(s),o.appendChild(r),t.appendChild(i),t.appendChild(o),t.appendChild(a),document.getElementsByTagName("main")[0].appendChild(t),n.lifeBar=d,n.lifeCount=s,n.moneyCount=r,this.dungeonsUI.push(n)},updateUI:function(e){var n=this;this.dungeons.forEach(function(e,t){const i=find(n.dungeonsUI,e.id);applyStyleOn(n.dungeonsUI[t].lifeBar,{height:e.life+"%"}),i.lifeCount.innerHTML=e.life,i.lifeCount.innerHTML=e.life,e.area.forEach(function(e,n){e.forEach(function(e,t){applyAttributesOn(i.area[n][t],{class:e.state}),applyStyleOn(i.area[n][t],e.style)})})})},broadcast:function(e,n){this.isServer&&this.room.broadcast.to(this.room.id).emit(e,n),this.room.emit(e,n)},toJSON:function(){return{id:this.id,dungeons:this.dungeons.map(function(e){return e.toJSON?e.toJSON():e})}}};